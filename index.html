<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UK News Ticker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            background-color: #141414;
            color: white;
            overflow: hidden;
            margin: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            height: 100vh;
            width: 100vw;
        }
        .ticker-container {
            position: relative;
            height: 100%;
            width: 100%;
        }
        .news-line {
            position: absolute;
            white-space: nowrap;
            font-weight: bold;
            cursor: default;
            user-select: none;
            will-change: transform;
        }
        #ui-overlay {
            position: fixed;
            top: 10px;
            right: 10px;
            background: rgba(0,0,0,0.6);
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 12px;
            pointer-events: none;
            z-index: 100;
            border: 1px solid #333;
        }
    </style>
</head>
<body>

    <div id="ui-overlay">
        SPACE to Pause | ESC to Refresh
    </div>

    <div class="ticker-container" id="container"></div>

    <script>
        /**
         * --- CONFIGURATION ---
         * 1. Get a FREE API Key at: https://bonobo.theguardian.com/register/developer
         * 2. Replace 'test' with your actual key.
         */
        const CONFIG = {
            apiKey: 'test', // 'test' works for limited queries, replace with your real key
            fontSize: 32,
            linePadding: 15,
            scrollSpeedMin: 70,
            scrollSpeedMax: 160,
            refreshInterval: 600000, // 10 minutes
            colors: ['#FFA500', '#00FFFF', '#FFFF00', '#00FF00', '#FF00FF', '#FFFFFF', '#FF4500']
        };

        const fallbackHeadlines = [
            "THE GUARDIAN API: UK TOP STORIES WILL APPEAR HERE.",
            "ERROR: NEWSAPI BLOCKS BROWSER REQUESTS ON FREE PLANS.",
            "SWITCHED TO THE GUARDIAN API FOR BETTER UK COVERAGE.",
            "PLEASE INSERT YOUR GUARDIAN API KEY IN THE CONFIG SECTION.",
            "PRESS SPACE TO PAUSE. PRESS ESC TO RETRY FETCH."
        ];

        let newsLines = [];
        let isPaused = false;
        let lastTimestamp = 0;
        const container = document.getElementById('container');

        class NewsLine {
            constructor(text, color, yPos) {
                this.text = text;
                this.color = color;
                this.y = yPos;
                // Start off-screen to the right with some randomness
                this.x = window.innerWidth + (Math.random() * 800);
                this.speed = CONFIG.scrollSpeedMin + (Math.random() * (CONFIG.scrollSpeedMax - CONFIG.scrollSpeedMin));
                
                this.element = document.createElement('div');
                this.element.className = 'news-line';
                this.element.style.fontSize = CONFIG.fontSize + 'px';
                this.element.style.color = color;
                this.element.style.top = yPos + 'px';
                this.element.innerText = text;
                container.appendChild(this.element);

                // Wait for layout to get width
                this.width = this.element.offsetWidth;
            }

            update(deltaTime) {
                if (isPaused) return;

                this.x -= this.speed * deltaTime;
                
                // Reset to right if fully off-screen to the left
                if (this.x < -this.width) {
                    this.x = window.innerWidth + 200;
                    // Vary speed on each cycle like the C version
                    this.speed = CONFIG.scrollSpeedMin + (Math.random() * (CONFIG.scrollSpeedMax - CONFIG.scrollSpeedMin));
                }
                
                this.element.style.transform = `translateX(${this.x}px)`;
            }

            remove() {
                if (this.element && this.element.parentNode) {
                    container.removeChild(this.element);
                }
            }
        }

        async function fetchNews() {
            // The Guardian API is much more friendly to browser-based requests
            // We search for UK news specifically.
            const url = `https://content.guardianapis.com/search?q=uk&api-key=${CONFIG.apiKey}&page-size=20`;
            
            try {
                const response = await fetch(url);
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                
                const data = await response.json();

                if (data.response && data.response.status === 'ok') {
                    return data.response.results.map(item => item.webTitle.toUpperCase());
                } else {
                    console.warn("Guardian API returned non-ok status:", data.response?.status);
                    return null;
                }
            } catch (err) {
                console.error("Fetch failure:", err);
                return null;
            }
        }

        async function rebuildTicker() {
            const rawHeadlines = await fetchNews();
            
            // Only use fallback if we actually failed to get results
            const headlines = (rawHeadlines && rawHeadlines.length > 0) ? rawHeadlines : fallbackHeadlines;

            // Cleanup existing elements
            newsLines.forEach(line => line.remove());
            newsLines = [];

            let yCursor = CONFIG.linePadding;
            headlines.forEach((text, index) => {
                const color = CONFIG.colors[index % CONFIG.colors.length];
                
                // Check if the next line will fit on screen
                if (yCursor + CONFIG.fontSize > window.innerHeight) return;

                const line = new NewsLine(text, color, yCursor);
                newsLines.push(line);
                yCursor += CONFIG.fontSize + CONFIG.linePadding;
            });
        }

        function animate(timestamp) {
            if (!lastTimestamp) lastTimestamp = timestamp;
            const deltaTime = (timestamp - lastTimestamp) / 1000;
            lastTimestamp = timestamp;

            // Independent updates for each line
            newsLines.forEach(line => line.update(deltaTime));
            requestAnimationFrame(animate);
        }

        // --- Interaction Listeners ---

        window.addEventListener('keydown', (e) => {
            if (e.code === 'Space') {
                isPaused = !isPaused;
                const overlay = document.getElementById('ui-overlay');
                overlay.innerText = isPaused ? "PAUSED" : "SPACE to Pause | ESC to Refresh";
                overlay.style.color = isPaused ? "#ff4500" : "white";
            }
            if (e.code === 'Escape') {
                rebuildTicker();
            }
        });

        window.addEventListener('load', () => {
            rebuildTicker();
            requestAnimationFrame(animate);

            if (CONFIG.refreshInterval > 0) {
                setInterval(rebuildTicker, CONFIG.refreshInterval);
            }
        });

        window.addEventListener('resize', () => {
            // Re-calc screen boundaries if window size changes
            lastTimestamp = 0; 
            // We don't necessarily rebuild on resize to avoid flicker, 
            // but the class handles screen width dynamically.
        });
    </script>
</body>
</html>
